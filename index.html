<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ğŸŒˆ ë¬´ì§€ê°œ ìœ ì¹˜ì› & ì–´ë¦°ì´ì§‘</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    :root {
      --bg:#f2f2f7; --card:#fff; --text:#1c1c1e; --sub:#8e8e93; --border:#e5e5ea;
      --accent:#ff6b6b; --yar:#ff9f0a; --blue:#007aff; --green:#34c759;
      --radius-card:16px; --radius-icon:14px;
    }
    body { font-family:'Noto Sans KR',-apple-system,sans-serif; background:var(--bg); color:var(--text); min-height:100vh; }

    /* ë¡œë”© */
    #globalLoader { position:fixed; inset:0; background:rgba(255,255,255,.96); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:9000; gap:14px; }
    #globalLoader.hidden { display:none; }
    .spinner { width:28px; height:28px; border:3px solid var(--border); border-top-color:var(--text); border-radius:50%; animation:spin .8s linear infinite; }
    @keyframes spin    { to { transform:rotate(360deg); } }
    @keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }
    .skel { border-radius:var(--radius-card); background:linear-gradient(90deg,#f0f0f0 25%,#e8e8e8 50%,#f0f0f0 75%); background-size:200% 100%; animation:shimmer 1.3s ease-in-out infinite; }

    /* í—¤ë” */
    .header { background:var(--card); border-bottom:1px solid var(--border); position:sticky; top:0; z-index:100; }
    .header-inner { max-width:640px; margin:0 auto; padding:10px 16px; display:flex; align-items:center; justify-content:space-between; }
    .logo { display:flex; align-items:center; gap:6px; text-decoration:none; }
    .logo-emoji { font-size:28px; }
    .logo-text  { display:flex; flex-direction:column; line-height:1.2; }
    .logo-main  { font-size:17px; font-weight:900; color:var(--text); }
    .logo-sub   { font-size:10px; color:var(--sub); }
    .board-link { padding:7px 14px; background:var(--text); color:#fff; border-radius:20px; font-size:12px; font-weight:700; text-decoration:none; }

    .container { max-width:640px; margin:0 auto; padding:0 0 80px; }

    /* ê³µì§€ì‚¬í•­ */
    .notice-section { padding:14px 16px 0; }
    .notice-card { background:var(--card); border-radius:var(--radius-card); padding:14px; border-left:4px solid var(--accent); box-shadow:0 1px 4px rgba(0,0,0,.06); margin-bottom:10px; cursor:pointer; }
    .notice-card:active { opacity:.85; }
    .notice-label { font-size:11px; font-weight:700; color:var(--accent); margin-bottom:4px; display:flex; align-items:center; justify-content:space-between; }
    .notice-label-hint { font-size:10px; font-weight:400; opacity:.7; }
    .notice-title { font-size:14px; font-weight:700; }
    .notice-body  { font-size:13px; color:var(--sub); line-height:1.5; margin-top:2px;
                    display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden; }
    /* ìƒì„¸ íŒ¨ë„ ë¯¸ë””ì–´ */
    .detail-media { padding:0 16px 12px; }
    .detail-media img { width:100%; border-radius:12px; display:block; margin-bottom:8px; max-height:400px; object-fit:cover; }
    .detail-media video { width:100%; border-radius:12px; display:block; margin-bottom:8px; max-height:400px; }
    .detail-media audio { width:100%; border-radius:12px; display:block; margin-bottom:8px; }
    .detail-media-icon { font-size:13px; color:var(--sub); margin-bottom:4px; }
    /* ë§í¬ */
    .detail-body a { color:var(--blue); text-decoration:underline; word-break:break-all; }

    /* ê³µì§€ ì‹œê°„ */
    .notice-time { font-size:11px; color:var(--sub); margin-top:4px; }
    /* ê³µì§€ ë”ë³´ê¸° ë²„íŠ¼ */
    .notice-more-btn { width:100%; padding:10px; background:transparent; border:1.5px solid var(--border); border-radius:var(--radius-card); font-size:13px; font-weight:700; color:var(--sub); cursor:pointer; font-family:inherit; margin-bottom:10px; }
    .notice-more-btn:active { opacity:.75; }
    /* ê¸€ì“°ê¸° ëª¨ë‹¬ */
    .write-overlay { position:fixed; inset:0; background:rgba(0,0,0,.5); display:flex; align-items:flex-end; justify-content:center; z-index:3000; }
    .write-overlay.hidden { display:none; }
    .write-panel { width:100%; max-width:640px; background:var(--card); border-radius:20px 20px 0 0; padding:0 0 env(safe-area-inset-bottom,0); }
    .write-handle { width:36px; height:4px; background:var(--border); border-radius:2px; margin:10px auto; }
    .write-head { padding:0 16px 12px; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid var(--border); }
    .write-head-title { font-size:17px; font-weight:900; }
    .write-close { padding:6px 14px; border:1px solid var(--border); border-radius:20px; background:var(--bg); font-size:12px; cursor:pointer; font-family:inherit; }
    .write-body { padding:16px; }
    .write-input { width:100%; padding:12px; border:1.5px solid var(--border); border-radius:12px; font-size:15px; font-family:inherit; margin-bottom:10px; }
    .write-input:focus { outline:none; border-color:var(--text); }
    .write-textarea { width:100%; padding:12px; border:1.5px solid var(--border); border-radius:12px; font-size:14px; font-family:inherit; min-height:120px; resize:none; line-height:1.6; }
    .write-textarea:focus { outline:none; border-color:var(--text); }
    .write-footer { display:flex; gap:8px; padding:12px 16px; border-top:1px solid var(--border); padding-bottom:calc(12px + env(safe-area-inset-bottom,0)); }
    .write-submit { flex:1; padding:13px; background:var(--text); color:#fff; border:none; border-radius:12px; font-size:15px; font-weight:700; cursor:pointer; font-family:inherit; }
    .write-submit:disabled { opacity:.5; }
    .write-error { font-size:12px; color:var(--accent); min-height:16px; padding:0 16px 8px; }
    /* ì„¹ì…˜ í—¤ë” */
    .section-header { padding:16px 16px 8px; display:flex; align-items:center; justify-content:space-between; }
    .section-title  { font-size:15px; font-weight:700; }
    .section-sub    { font-size:12px; color:var(--sub); }

    /* ìºë¦­í„° ê°€ë¡œ ìŠ¤í¬ë¡¤ */
    .char-scroll-wrap { overflow-x:auto; padding:0 16px 8px; -webkit-overflow-scrolling:touch; scrollbar-width:none; }
    .char-scroll-wrap::-webkit-scrollbar { display:none; }
    .char-grid { display:flex; gap:10px; width:max-content; }
    .char-item { display:flex; flex-direction:column; align-items:center; gap:5px; cursor:pointer; width:80px; flex-shrink:0; }
    .char-icon { width:80px; height:80px; border-radius:var(--radius-icon); background:var(--card); border:1.5px solid var(--border); display:flex; align-items:center; justify-content:center; font-size:34px; overflow:hidden; position:relative; box-shadow:0 1px 4px rgba(0,0,0,.08); transition:transform .15s; }
    .char-item:active .char-icon { transform:scale(.93); }
    .char-icon img { width:100%; height:100%; object-fit:cover; }
    .char-name { font-size:11px; font-weight:700; color:var(--sub); width:80px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; text-align:center; }
    .unread-badge { position:absolute; top:-3px; right:-3px; width:10px; height:10px; background:var(--accent); border-radius:50%; border:2px solid var(--bg); }

    /* íƒ­ */
    .tab-bar { display:flex; gap:0; padding:0 16px; margin-bottom:2px; border-bottom:1.5px solid var(--border); }
    .tab-btn { flex:1; padding:10px 0; font-size:14px; font-weight:700; color:var(--sub); background:none; border:none; cursor:pointer; font-family:inherit; border-bottom:2.5px solid transparent; margin-bottom:-1.5px; transition:color .15s,border-color .15s; }
    .tab-btn.active { color:var(--text); border-bottom-color:var(--text); }

    /* í”¼ë“œ ì¹´ë“œ */
    .feed-section { padding:10px 16px 0; }
    .feed-card { background:var(--card); border-radius:var(--radius-card); padding:14px; margin-bottom:10px; box-shadow:0 1px 4px rgba(0,0,0,.06); }
    /* ì¹´ë“œ í—¤ë”: ì•„ë°”íƒ€ + ì´ë¦„ + ì‹œê°„ */
    .feed-card-head { display:flex; align-items:center; gap:8px; margin-bottom:8px; }
    .feed-avatar { width:36px; height:36px; border-radius:10px; background:var(--bg); display:flex; align-items:center; justify-content:center; font-size:20px; flex-shrink:0; overflow:hidden; border:1px solid var(--border); }
    .feed-avatar img { width:100%; height:100%; object-fit:cover; }
    .feed-author-wrap { display:flex; flex-direction:column; }
    .feed-char-name  { font-size:13px; font-weight:700; }
    .feed-author-type { font-size:10px; color:var(--sub); }
    .feed-time { font-size:11px; color:var(--sub); margin-left:auto; white-space:nowrap; }
    /* ì œëª©/ë³¸ë¬¸ â€” í´ë¦­í•˜ë©´ ìƒì„¸ íŒ¨ë„ ì—´ë¦¼ */
    .feed-content { cursor:pointer; }
    .feed-content:active { opacity:.75; }
    .feed-title { font-size:14px; font-weight:700; margin-bottom:4px; }
    .feed-body  { font-size:13px; color:var(--sub); line-height:1.5; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
    /* í†µê³„ + ì•¼ë¥´ ë²„íŠ¼ */
    .feed-footer { display:flex; align-items:center; gap:0; margin-top:10px; }
    .feed-stats  { font-size:12px; color:var(--sub); display:flex; gap:10px; }
    .feed-stat   { display:flex; align-items:center; gap:3px; }
    .yar-btn { margin-left:auto; display:flex; align-items:center; gap:4px; padding:5px 12px; border-radius:20px; border:1.5px solid var(--border); background:var(--bg); font-size:12px; font-weight:700; cursor:pointer; font-family:inherit; color:var(--sub); white-space:nowrap; }
    .yar-btn.active { border-color:var(--yar); color:var(--yar); background:#fff9ee; }
    @keyframes yarBounce { 0%{transform:scale(1)} 30%{transform:scale(1.35)} 60%{transform:scale(.9)} 80%{transform:scale(1.1)} 100%{transform:scale(1)} }
    .yar-btn.bounce { animation:yarBounce .35s cubic-bezier(.36,.07,.19,.97) both; }

    /* ë‚´ ê¸€ ë°°ì§€ */
    .mine-badge { font-size:10px; font-weight:700; color:var(--blue); background:#e8f0fe; border-radius:10px; padding:2px 7px; margin-left:6px; vertical-align:middle; }
    /* ìƒˆ ê¸°ê¸° í† ìŠ¤íŠ¸ */
    .device-toast { position:fixed; top:70px; left:50%; transform:translateX(-50%); background:#1c1c1e; color:#fff; padding:10px 18px; border-radius:20px; font-size:13px; font-weight:600; z-index:500; opacity:0; transition:opacity .3s; pointer-events:none; white-space:nowrap; max-width:90vw; text-align:center; }
    .device-toast.show { opacity:1; }
    /* ë” ë³´ê¸° */
    .load-more { width:calc(100% - 32px); margin:0 16px 10px; padding:13px; background:var(--card); border:1.5px solid var(--border); border-radius:var(--radius-card); font-size:14px; font-weight:700; color:var(--sub); cursor:pointer; font-family:inherit; }
    .load-more:disabled { opacity:.5; }

    /* ë°”í…€ ë„¤ë¹„ */
    .bottom-nav { position:fixed; bottom:0; left:0; right:0; background:var(--card); border-top:1px solid var(--border); display:flex; z-index:100; padding-bottom:env(safe-area-inset-bottom,0); }
    .bottom-nav a { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:8px 0 6px; text-decoration:none; color:var(--sub); font-size:10px; font-weight:600; gap:2px; }
    .bottom-nav a.active { color:var(--text); }
    .nav-icon { font-size:22px; }

    /* â”€â”€ ì˜¤ë²„ë ˆì´ ê³µí†µ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .overlay { position:fixed; inset:0; background:rgba(0,0,0,.5); display:flex; align-items:flex-end; justify-content:center; z-index:2000; }
    .overlay.hidden { display:none; }

    /* â”€â”€ ê²Œì‹œê¸€ ìƒì„¸ íŒ¨ë„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .detail-panel { width:100%; max-width:640px; background:var(--card); border-radius:20px 20px 0 0; max-height:90vh; display:flex; flex-direction:column; }
    .detail-handle { width:36px; height:4px; background:var(--border); border-radius:2px; margin:10px auto 0; flex-shrink:0; }
    .detail-head   { padding:12px 16px 10px; border-bottom:1px solid var(--border); flex-shrink:0; }
    .detail-title  { font-size:17px; font-weight:900; margin-bottom:6px; }
    .detail-meta   { font-size:12px; color:var(--sub); display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
    .detail-meta-author { font-weight:700; color:var(--text); }
    .detail-scroll { flex:1; overflow-y:auto; }
    .detail-body   { padding:14px 16px; font-size:14px; line-height:1.7; border-bottom:1px solid var(--border); white-space:pre-wrap; }
    .detail-footer { padding:10px 16px; display:flex; align-items:center; gap:10px; border-bottom:1px solid var(--border); flex-shrink:0; }
    .detail-stat   { font-size:13px; color:var(--sub); }
    .detail-yar    { margin-left:auto; display:flex; align-items:center; gap:4px; padding:6px 14px; border-radius:20px; border:1.5px solid var(--border); background:var(--bg); font-size:13px; font-weight:700; cursor:pointer; font-family:inherit; color:var(--sub); }
    .detail-yar.active { border-color:var(--yar); color:var(--yar); background:#fff9ee; }
    .detail-close  { padding:6px 14px; border:1px solid var(--border); border-radius:20px; background:var(--bg); font-size:12px; cursor:pointer; font-family:inherit; flex-shrink:0; }
    /* ëŒ“ê¸€ */
    .comments-wrap  { padding:0 16px 10px; }
    .ctab { padding:4px 10px; border-radius:20px; border:1.5px solid var(--border); background:var(--bg); color:var(--sub); font-size:11px; font-weight:700; cursor:pointer; font-family:inherit; }
    .ctab-active { border-color:var(--text); background:var(--text); color:#fff; }
    .comments-title { font-size:13px; font-weight:700; color:var(--sub); padding:12px 0 8px; }
    .comment-item   { padding:10px 0; border-bottom:1px solid var(--border); display:flex; gap:8px; align-items:flex-start; }
    .comment-item:last-child { border-bottom:none; }
    .comment-avatar { width:28px; height:28px; border-radius:8px; background:var(--bg); border:1px solid var(--border); display:flex; align-items:center; justify-content:center; font-size:15px; flex-shrink:0; overflow:hidden; }
    .comment-avatar img { width:100%; height:100%; object-fit:cover; }
    .comment-right  { flex:1; min-width:0; }
    .comment-nick   { font-size:12px; font-weight:700; }
    .comment-body   { font-size:13px; line-height:1.5; margin-top:3px; }
    .comment-time   { font-size:11px; color:var(--sub); margin-top:2px; }
    /* ëŒ“ê¸€ ì…ë ¥ */
    .comment-form  { flex-shrink:0; background:var(--card); border-top:1px solid var(--border); padding:10px 16px; display:flex; gap:8px; padding-bottom:calc(10px + env(safe-area-inset-bottom,0)); }
    .comment-input { flex:1; padding:10px 12px; border:1.5px solid var(--border); border-radius:22px; font-size:14px; font-family:inherit; }
    .comment-input:focus { outline:none; border-color:var(--text); }
    .comment-send  { padding:10px 16px; background:var(--text); color:#fff; border:none; border-radius:22px; font-size:13px; font-weight:700; cursor:pointer; font-family:inherit; white-space:nowrap; }
    .comment-send:disabled { opacity:.5; }

    /* â”€â”€ ìºë¦­í„° í”„ë¡œí•„ íŒ¨ë„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .profile-panel  { width:100%; max-width:580px; background:var(--card); border-radius:20px 20px 0 0; max-height:88vh; overflow-y:auto; padding-bottom:env(safe-area-inset-bottom,16px); }
    .profile-handle { width:36px; height:4px; background:var(--border); border-radius:2px; margin:10px auto 0; }
    .profile-head   { padding:14px 16px; display:flex; align-items:center; gap:12px; border-bottom:1px solid var(--border); }
    .profile-avatar { width:64px; height:64px; border-radius:var(--radius-icon); background:var(--bg); border:1px solid var(--border); display:flex; align-items:center; justify-content:center; font-size:34px; overflow:hidden; flex-shrink:0; }
    .profile-avatar img { width:100%; height:100%; object-fit:cover; }
    .profile-info   { flex:1; }
    .profile-name   { font-size:20px; font-weight:900; }
    .profile-meta   { font-size:12px; color:var(--sub); margin-top:2px; }
    .profile-close  { padding:8px; border:none; background:var(--bg); border-radius:50%; cursor:pointer; font-size:16px; color:var(--sub); width:36px; height:36px; display:flex; align-items:center; justify-content:center; border:1px solid var(--border); }
    .profile-body   { padding:14px 16px; }
    .profile-tags   { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px; }
    .profile-tag    { padding:5px 12px; background:var(--bg); border-radius:20px; font-size:12px; color:var(--sub); border:1px solid var(--border); }
    .profile-section-title { font-size:13px; font-weight:700; color:var(--sub); margin-bottom:8px; }
    .profile-post   { background:var(--bg); border-radius:10px; padding:10px; margin-bottom:6px; cursor:pointer; }
    .profile-post:active { opacity:.8; }
    .profile-post-title { font-size:13px; font-weight:700; }
    .profile-post-meta  { font-size:11px; color:var(--sub); margin-top:2px; }

    /* â”€â”€ ë‹‰ë„¤ì„ ëª¨ë‹¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .nick-overlay { position:fixed; inset:0; background:rgba(0,0,0,.5); display:flex; align-items:center; justify-content:center; z-index:3000; padding:20px; }
    .nick-overlay.hidden { display:none; }
    .nick-box   { background:var(--card); border-radius:20px; padding:24px; width:100%; max-width:320px; }
    .nick-title { font-size:17px; font-weight:900; margin-bottom:6px; }
    .nick-sub   { font-size:13px; color:var(--sub); margin-bottom:16px; line-height:1.5; }
    .nick-input { width:100%; padding:12px; border:1.5px solid var(--border); border-radius:12px; font-size:15px; font-family:inherit; text-align:center; margin-bottom:8px; }
    .nick-input:focus { outline:none; border-color:var(--text); }
    .nick-error { font-size:12px; color:var(--accent); min-height:16px; margin-bottom:8px; }
    .nick-btn   { width:100%; padding:13px; background:var(--text); color:#fff; border:none; border-radius:12px; font-size:15px; font-weight:700; cursor:pointer; font-family:inherit; }
  </style>
</head>
<body>

<!-- ìƒˆ ê¸°ê¸° í† ìŠ¤íŠ¸ -->
<div class="device-toast" id="deviceToast">ğŸŒˆ ìƒˆë¡œìš´ êµì‹¤ë¡œ ë“¤ì–´ì™”ì–´ìš”! ì—¬ê¸°ì„œ ë‹‰ë„¤ì„ì„ ìƒˆë¡œ ì„¤ì •í•  ìˆ˜ ìˆì–´ìš”.</div>

<!-- ë¡œë”© -->
<div id="globalLoader">
  <div style="font-size:52px;">ğŸŒˆ</div>
  <div class="spinner"></div>
  <div style="font-size:14px;color:var(--sub);">ë¬´ì§€ê°œ ìœ ì¹˜ì› ë¡œë”© ì¤‘...</div>
</div>

<!-- í—¤ë” -->
<div class="header">
  <div class="header-inner">
    <a class="logo" href="index.html">
      <span class="logo-emoji">ğŸŒˆ</span>
      <span class="logo-text">
        <span class="logo-main">ë¬´ì§€ê°œ</span>
        <span class="logo-sub">ìœ ì¹˜ì› & ì–´ë¦°ì´ì§‘</span>
      </span>
    </a>
    <div style="display:flex;gap:8px;align-items:center;">
      <button onclick="softRefresh()" style="width:34px;height:34px;border-radius:50%;background:var(--bg);border:1px solid var(--border);font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;" title="ìƒˆë¡œê³ ì¹¨">ğŸ”„</button>
      <a href="mypage.html" style="padding:7px 14px;background:var(--bg);color:var(--text);border-radius:20px;font-size:12px;font-weight:700;text-decoration:none;border:1px solid var(--border);">ğŸ‘¤ ë‚´ í˜ì´ì§€</a>
    </div>
  </div>
</div>

<div class="container">

  <!-- ê³µì§€ì‚¬í•­ -->
  <div class="notice-section" id="noticeSection">
    <div class="skel" style="height:72px;margin-bottom:10px;"></div>
  </div>

  <!-- ìºë¦­í„° ê·¸ë¦¬ë“œ -->
  <div class="section-header">
    <span class="section-title">ğŸŒˆ ìš°ë¦¬ ì¹œêµ¬ë“¤</span>
    <span class="section-sub" id="charCount"></span>
  </div>
  <div class="char-scroll-wrap">
    <div class="char-grid" id="charGrid">
      <div class="char-item"><div class="char-icon skel"></div></div>
      <div class="char-item"><div class="char-icon skel"></div></div>
      <div class="char-item"><div class="char-icon skel"></div></div>
      <div class="char-item"><div class="char-icon skel"></div></div>
      <div class="char-item"><div class="char-icon skel"></div></div>
      <div class="char-item"><div class="char-icon skel"></div></div>
    </div>
  </div>

  <!-- ì´ì•¼ê¸° íƒ­ + í”¼ë“œ -->
  <div class="section-header" style="margin-top:10px;">
    <span class="section-title">ğŸ“ ì´ì•¼ê¸°</span>
  </div>
  <!-- ìµœì‹ ìˆœ / ì¸ê¸°ìˆœ íƒ­ -->
  <div class="tab-bar">
    <button class="tab-btn active" id="tabLatest"  onclick="switchTab('latest')">ğŸ• ìµœì‹ ìˆœ</button>
    <button class="tab-btn"        id="tabPopular" onclick="switchTab('popular')">ğŸ”¥ ì¸ê¸°ìˆœ</button>
  </div>
  <div class="feed-section" id="feedSection">
    <div class="skel" style="height:120px;margin-bottom:10px;margin-top:10px;"></div>
    <div class="skel" style="height:120px;margin-bottom:10px;"></div>
    <div class="skel" style="height:120px;margin-bottom:10px;"></div>
  </div>
  <button class="load-more hidden" id="loadMoreBtn" onclick="loadMore()">ë” ë³´ê¸°</button>

</div>

<!-- ë°”í…€ ë„¤ë¹„ -->
<div class="bottom-nav">
  <a href="index.html" class="active"><span class="nav-icon">ğŸ </span>í™ˆ</a>
  <a href="#" onclick="openWrite();return false;" style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:8px 0 6px;text-decoration:none;color:var(--sub);font-size:10px;font-weight:600;gap:2px;">
    <span style="font-size:22px;width:42px;height:28px;background:var(--text);border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:18px;">âœï¸</span>ê¸€ì“°ê¸°
  </a>
  <a href="mypage.html"><span class="nav-icon">ğŸ‘¤</span>ë‚´ í˜ì´ì§€</a>
</div>

<!-- ê¸€ì“°ê¸° ëª¨ë‹¬ -->
<div class="write-overlay hidden" id="writeOverlay" onclick="handleWriteOverlay(event)">
  <div class="write-panel" onclick="event.stopPropagation()">
    <div class="write-handle"></div>
    <div class="write-head">
      <div class="write-head-title">âœï¸ ì´ì•¼ê¸° ì“°ê¸°</div>
      <button class="write-close" onclick="closeWrite()">âœ• ë‹«ê¸°</button>
    </div>
    <div class="write-body">
      <input class="write-input" id="writeTitle" placeholder="ì œëª© (2~80ì)" maxlength="80">
      <textarea class="write-textarea" id="writeBody" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”... (5ì ì´ìƒ)" maxlength="5000"></textarea>
    </div>
    <div class="write-error" id="writeError"></div>
    <div class="write-footer">
      <button class="write-submit" id="writeSubmitBtn" onclick="submitWrite()">ê²Œì‹œí•˜ê¸°</button>
    </div>
  </div>
</div>

<!-- ê²Œì‹œê¸€ ìƒì„¸ íŒ¨ë„ -->
<div class="overlay hidden" id="detailOverlay" onclick="handleDetailOverlay(event)">
  <div class="detail-panel" onclick="event.stopPropagation()">
    <div class="detail-handle"></div>
    <div class="detail-head">
      <div class="detail-title" id="dTitle"></div>
      <div class="detail-meta">
        <span class="detail-meta-author" id="dAuthor"></span>
        <span id="dTime"></span>
      </div>
    </div>
    <div class="detail-scroll">
      <div class="detail-body" id="dBody"></div>
      <div class="detail-media" id="dMedia"></div>
      <div class="detail-footer">
        <span class="detail-stat" id="dStats"></span>
        <button class="detail-yar" id="dYarBtn" onclick="toggleDetailYar()">ğŸŒŸ ì•¼ë¥´~</button>
        <button class="detail-close" onclick="closeDetail()">âœ• ë‹«ê¸°</button>
      </div>
      <div class="comments-wrap">
        <div style="display:flex;align-items:center;justify-content:space-between;padding:10px 0 6px;">
          <span style="font-size:13px;font-weight:700;color:var(--sub);">ëŒ“ê¸€</span>
          <div style="display:flex;gap:6px;">
            <button id="cTabLatest"  onclick="switchCommentTab('latest')"  class="ctab ctab-active">ìµœì‹ ìˆœ</button>
            <button id="cTabPopular" onclick="switchCommentTab('popular')" class="ctab">ì¸ê¸°ìˆœ</button>
          </div>
        </div>
        <div id="dComments"></div>
      </div>
    </div>
    <div class="comment-form">
      <input class="comment-input" id="commentInput" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." maxlength="500">
      <button class="comment-send" onclick="submitComment()">ì „ì†¡</button>
    </div>
  </div>
</div>

<!-- ìºë¦­í„° í”„ë¡œí•„ íŒ¨ë„ -->
<div class="overlay hidden" id="profileOverlay" onclick="handleProfileOverlay(event)">
  <div class="profile-panel" onclick="event.stopPropagation()">
    <div class="profile-handle"></div>
    <div class="profile-head">
      <div class="profile-avatar" id="pAvatar">ğŸ™‚</div>
      <div class="profile-info">
        <div class="profile-name" id="pName"></div>
        <div class="profile-meta" id="pMeta"></div>
      </div>
      <button class="profile-close" onclick="closeProfile()">âœ•</button>
    </div>
    <div class="profile-body">
      <div class="profile-tags" id="pTags"></div>
      <div class="profile-section-title">ìµœê·¼ ê¸€</div>
      <div id="pPosts"></div>
    </div>
  </div>
</div>

<!-- ë‹‰ë„¤ì„ ëª¨ë‹¬ -->
<div class="nick-overlay hidden" id="nickOverlay" onclick="handleNickOverlay(event)">
  <div class="nick-box" onclick="event.stopPropagation()">
    <div class="nick-title">ë‹‰ë„¤ì„ ì„¤ì •</div>
    <div class="nick-sub" id="nickSub">ì•¼ë¥´~ë¥¼ ëˆ„ë¥´ê±°ë‚˜ ëŒ“ê¸€ì„ ì“°ë ¤ë©´ ë‹‰ë„¤ì„ì´ í•„ìš”í•´ìš”!</div>
    <input class="nick-input" id="nickInput" placeholder="ë‹‰ë„¤ì„ ì…ë ¥ (1~10ì)" maxlength="10" autocomplete="off">
    <div class="nick-error" id="nickError"></div>
    <button class="nick-btn" onclick="submitNickname()">í™•ì¸</button>
  </div>
</div>

<script>
  const API = 'https://rainbowkidz-api.irunaru.workers.dev/api/v1';

  // â”€â”€ ìƒíƒœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let characters   = [];
  let feedPosts    = [];
  let currentSort  = 'latest';
  let feedOffset   = 0;
  const FEED_LIMIT = 20;
  let hasMore      = false;
  let guestId      = null;
  let myNickname   = null;
  let pendingYarId = null;   // ë‹‰ë„¤ì„ ì„¤ì • í›„ ì•¼ë¥´~í•  í”¼ë“œ í¬ìŠ¤íŠ¸ ID
  let pendingAction = null;  // 'yar' | 'comment'

  // ìƒì„¸ íŒ¨ë„ ìƒíƒœ
  let currentPost     = null;  // í˜„ì¬ ì—´ë¦° ê²Œì‹œê¸€ ì „ì²´ ë°ì´í„°
  let currentComments = [];    // í˜„ì¬ ëŒ“ê¸€ ì›ë³¸ (ì •ë ¬ìš©)
  let commentSort     = 'latest';

  // â”€â”€ ìœ í‹¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const esc = s => String(s ?? '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');

  // ìƒˆë¡œê³ ì¹¨ (ì†Œí”„íŠ¸: í”¼ë“œ+ê³µì§€ë§Œ ë‹¤ì‹œ ë¡œë“œ)
  async function softRefresh() {
    const btn = document.querySelector('[onclick="softRefresh()"]');
    if (btn) { btn.style.animation = 'spin .6s linear'; setTimeout(() => btn.style.animation = '', 700); }
    await Promise.all([loadNotices(), loadCharacters(), loadFeed(true)]);
  }

  /** í…ìŠ¤íŠ¸ì˜ URLì„ í´ë¦­ ê°€ëŠ¥í•œ ë§í¬ë¡œ ë³€í™˜ (XSS ì•ˆì „) */
  // ë¯¸ë””ì–´ URL íƒ€ì… ê°ì§€
  function detectMediaType(url) {
    if (!url) return null;
    const u = url.toLowerCase().split('?')[0];
    if (/\.(jpg|jpeg|png|gif|webp|avif|svg)$/.test(u)) return 'image';
    if (/\.(mp4|webm|mov|avi|mkv)$/.test(u)) return 'video';
    if (/\.(mp3|wav|ogg|m4a|aac|flac)$/.test(u)) return 'audio';
    if (/youtube\.com|youtu\.be/.test(url)) return 'youtube';
    return 'link';
  }

  function linkify(text) {
    const escaped = esc(text);
    return escaped.replace(/(https?:\/\/[^\s&<>"]+)/g,
      '<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>');
  }
  const relTime = d => {
    const s = (Date.now() - new Date(d)) / 1000;
    if (s < 60)     return 'ë°©ê¸ˆ';
    if (s < 3600)   return `${Math.floor(s/60)}ë¶„ ì „`;
    if (s < 86400)  return `${Math.floor(s/3600)}ì‹œê°„ ì „`;
    if (s < 604800) return `${Math.floor(s/86400)}ì¼ ì „`;
    return new Date(d).toLocaleDateString('ko-KR',{month:'long',day:'numeric'});
  };
  const groupLabel = g => g==='kindergarten'?'ìœ ì¹˜ì›':g==='daycare'?'ì–´ë¦°ì´ì§‘':'ì„ ìƒë‹˜';
  const getYar   = id => localStorage.getItem(`rkYar_${id}`) === '1';
  const setYar   = (id, v) => localStorage.setItem(`rkYar_${id}`, v ? '1' : '0');
  const getVisit = id => parseInt(localStorage.getItem(`rkVisit_${id}`) || '0');
  const setVisit = id => localStorage.setItem(`rkVisit_${id}`, Date.now());

  // ESC ë‹«ê¸°
  document.addEventListener('keydown', e => {
    if (e.key !== 'Escape') return;
    closeDetail(); closeProfile(); closeWrite();
    document.getElementById('nickOverlay').classList.add('hidden');
  });

  // â”€â”€ ê²ŒìŠ¤íŠ¸ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function initGuest() {
    try {
      const r = await fetch(`${API}/guest/init`, { method:'POST', credentials:'include' });
      if (!r.ok) return;
      const d = await r.json();
      guestId = d.guest_id;

      // ìƒˆ ê¸°ê¸° ê°ì§€: is_new=trueì´ê³  ì´ì „ì— ë³¸ ì  ì—†ìœ¼ë©´ í† ìŠ¤íŠ¸
      if (d.is_new && !localStorage.getItem('rkSeen')) {
        setTimeout(() => {
          const t = document.getElementById('deviceToast');
          if (t) { t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 4000); }
        }, 1200);
      }
      localStorage.setItem('rkSeen', '1');

      // í•­ìƒ /me í˜¸ì¶œ (has_nickname ì—¬ë¶€ì™€ ë¬´ê´€í•˜ê²Œ ë‹‰ë„¤ì„ í™•ì¸)
      try {
        const m = await fetch(`${API}/me`, { credentials:'include' });
        if (m.ok) { const md = await m.json(); myNickname = md.guest?.nickname || null; }
      } catch {}
      // /me ì‹¤íŒ¨ ì‹œ localStorage í´ë°±
      if (!myNickname) myNickname = localStorage.getItem('rkNickname');
    } catch {}
  }

  // â”€â”€ ê³µì§€ì‚¬í•­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let allNotices = [];
  let noticesExpanded = false;

  async function loadNotices() {
    const sec = document.getElementById('noticeSection');
    try {
      const r = await fetch(`${API}/notices?limit=10`);
      const d = await r.json();
      allNotices = d.notices || [];
      renderNotices();
    } catch { sec.innerHTML = ''; }
  }

  function renderNotices() {
    const sec = document.getElementById('noticeSection');
    sec.innerHTML = '';
    if (!allNotices.length) return;

    const visible = noticesExpanded ? allNotices : allNotices.slice(0, 1);
    visible.forEach(n => {
      const card = document.createElement('div');
      card.className = 'notice-card';
      const mtype = detectMediaType(n.media_url);
      const thumbHtml = (n.media_url && mtype === 'image')
        ? `<img src="${esc(n.media_url)}" style="width:100%;border-radius:8px;margin-top:8px;max-height:120px;object-fit:cover;" loading="lazy">`
        : (n.media_url && mtype === 'video')
        ? `<div style="margin-top:6px;font-size:12px;color:var(--sub);">ğŸ¬ ë™ì˜ìƒ ì²¨ë¶€</div>`
        : (n.media_url && mtype === 'audio')
        ? `<div style="margin-top:6px;font-size:12px;color:var(--sub);">ğŸµ ìŒì•… ì²¨ë¶€</div>`
        : '';
      card.innerHTML = `
        <div class="notice-label">
          <span>ğŸ“Œ ê³µì§€</span>
          <span class="notice-label-hint">íƒ­í•˜ë©´ ìì„¸íˆ ë³´ê¸° â€º</span>
        </div>
        <div class="notice-title">${esc(n.title||'')}</div>
        <div class="notice-body">${esc(n.body||'')}</div>
        <div class="notice-time">${relTime(n.created_at)}</div>
        ${thumbHtml}`;
      card.onclick = () => openDetail(n.id);
      sec.appendChild(card);
    });

    // ê³µì§€ê°€ 2ê°œ ì´ìƒì´ë©´ ë”ë³´ê¸°/ì ‘ê¸° ë²„íŠ¼
    if (allNotices.length > 1) {
      const moreBtn = document.createElement('button');
      moreBtn.className = 'notice-more-btn';
      moreBtn.id = 'noticeMoreBtn';
      moreBtn.textContent = noticesExpanded
        ? `â–² ì ‘ê¸°`
        : `â–¼ ê³µì§€ ë”ë³´ê¸° (${allNotices.length - 1}ê°œ ë”)`;
      moreBtn.onclick = () => {
        noticesExpanded = !noticesExpanded;
        renderNotices();
      };
      sec.appendChild(moreBtn);
    }
  }

  // â”€â”€ ìºë¦­í„° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadCharacters() {
    try {
      const r = await fetch(`${API}/characters`);
      if (r.ok) {
        const d = await r.json();
        characters = d.characters?.length ? d.characters : MOCK_CHARS;
      } else { characters = MOCK_CHARS; }
    } catch { characters = MOCK_CHARS; }
    renderCharGrid();
  }

  function renderCharGrid() {
    const grid = document.getElementById('charGrid');
    document.getElementById('charCount').textContent = `${characters.length}ëª…`;
    grid.innerHTML = characters.map(c => {
      const isNew = getVisit(c.id) === 0;
      const imgHtml = c.image_url
        ? `<img src="${esc(c.image_url)}" alt="${esc(c.display_name)}" data-emoji="${esc(c.emoji||'ğŸ™‚')}" onerror="this.parentElement.removeChild(this);this.parentElement.textContent=this.dataset.emoji">`
        : '';
      const name = c.display_name.length > 4 ? c.display_name.slice(0,4)+'â€¦' : c.display_name;
      return `<div class="char-item" onclick="openProfile(${c.id})">
        <div class="char-icon">${imgHtml || esc(c.emoji||'ğŸ™‚')}${isNew?'<div class="unread-badge"></div>':''}</div>
        <div class="char-name">${esc(name)}</div>
      </div>`;
    }).join('');
  }

  // â”€â”€ íƒ­ ì „í™˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function switchTab(sort) {
    if (currentSort === sort) return;
    currentSort = sort;
    document.getElementById('tabLatest').classList.toggle('active',  sort === 'latest');
    document.getElementById('tabPopular').classList.toggle('active', sort === 'popular');
    loadFeed(true);
  }

  // â”€â”€ í”¼ë“œ ë¡œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadFeed(reset = false) {
    if (reset) { feedPosts = []; feedOffset = 0; }
    if (reset) {
      document.getElementById('feedSection').innerHTML =
        '<div class="skel" style="height:120px;margin-bottom:10px;margin-top:10px;"></div>'.repeat(3);
      document.getElementById('loadMoreBtn').classList.add('hidden');
    }
    try {
      const r = await fetch(`${API}/timeline?sort=${currentSort}&limit=${FEED_LIMIT}&offset=${feedOffset}`);
      const d = await r.json();
      const newPosts = d.posts || [];
      feedPosts = reset ? newPosts : [...feedPosts, ...newPosts];
      hasMore = (feedOffset + newPosts.length) < d.total;
      feedOffset += newPosts.length;
      renderFeed(reset);
    } catch {
      document.getElementById('feedSection').innerHTML =
        '<div style="padding:24px;color:var(--sub);text-align:center;font-size:14px;">ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</div>';
    }
  }

  async function loadMore() {
    const btn = document.getElementById('loadMoreBtn');
    btn.disabled = true; btn.textContent = 'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
    await loadFeed(false);
    btn.disabled = false; btn.textContent = 'ë” ë³´ê¸°';
  }

  // â”€â”€ í”¼ë“œ ë Œë” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderFeed(reset = true) {
    const sec = document.getElementById('feedSection');
    if (!feedPosts.length) {
      sec.innerHTML = '<div style="padding:24px;color:var(--sub);text-align:center;font-size:14px;">ì•„ì§ ì´ì•¼ê¸°ê°€ ì—†ì–´ìš”</div>';
      document.getElementById('loadMoreBtn').classList.add('hidden');
      return;
    }
    if (reset) {
      sec.innerHTML = '';
      feedPosts.forEach(p => sec.appendChild(makeFeedCard(p)));
    } else {
      // ë”ë³´ê¸°: ìƒˆë¡œ ì¶”ê°€ëœ ê²ƒë§Œ append
      const newItems = feedPosts.slice(feedOffset - (feedPosts.length - (feedOffset - (feedPosts.length % FEED_LIMIT || FEED_LIMIT))));
      feedPosts.slice(-Math.min(FEED_LIMIT, feedPosts.length)).forEach(p => {
        if (!document.getElementById(`feed-${p.id}`)) sec.appendChild(makeFeedCard(p));
      });
    }
    const btn = document.getElementById('loadMoreBtn');
    if (hasMore) { btn.classList.remove('hidden'); btn.textContent = 'ë” ë³´ê¸°'; }
    else         { btn.classList.add('hidden'); }
  }

  function makeFeedCard(p) {
    const isYar = getYar(p.id);
    // ì‘ì„±ì í‘œì‹œ: ìºë¦­í„° or ê²ŒìŠ¤íŠ¸
    const isSystem  = p.author_type === 'system';
    const authorName = isSystem ? (p.character_name||'ìºë¦­í„°') : (p.nickname||'ìµëª…');
    const authorType = isSystem ? '' : 'ì´ì•¼ê¸°íŒ';
    const isMine = !isSystem && !!p.is_mine;

    // ì•„ë°”íƒ€: í”„ë¡œí•„ ì´ë¯¸ì§€ â†’ ì´ëª¨ì§€ í´ë°±
    let avatarHtml;
    if (isSystem && p.character_image_url) {
      avatarHtml = `<img src="${esc(p.character_image_url)}" alt="${esc(authorName)}" data-emoji="${esc(p.character_emoji||'ğŸ‘¤')}" onerror="this.parentElement.removeChild(this);this.parentElement.textContent=this.dataset.emoji">`;
    } else {
      avatarHtml = esc(p.character_emoji || (isSystem ? 'ğŸ‘¤' : 'ğŸ—£ï¸'));
    }

    const card = document.createElement('div');
    card.className = 'feed-card';
    card.id = `feed-${p.id}`;
    card.innerHTML = `
      <div class="feed-card-head">
        <div class="feed-avatar">${avatarHtml}</div>
        <div class="feed-author-wrap">
          <span class="feed-char-name">${esc(authorName)}</span>
          ${authorType ? `<span class="feed-author-type">${esc(authorType)}</span>` : ''}
        </div>
        <span class="feed-time">${relTime(p.created_at)}</span>
      </div>
      <div class="feed-content" onclick="openDetail(${p.id})">
        ${p.title ? `<div class="feed-title">${esc(p.title)}${isMine ? '<span class="mine-badge">ë‚´ ê¸€</span>' : ''}</div>` : ''}
        <div class="feed-body">${esc(p.body||'')}</div>
      </div>
      <div class="feed-footer">
        <div class="feed-stats">
          <span class="feed-stat">ğŸ’¬ ëŒ“ê¸€ ${p.comment_count||0}</span>
          <span class="feed-stat">ğŸ‘ ì¡°íšŒ ${p.view_count||0}</span>
        </div>
        <button class="yar-btn${isYar?' active':''}" id="yar-${p.id}" onclick="toggleYar(event,${p.id})">
          ğŸŒŸ ì•¼ë¥´~ ${p.yar_count||0}
        </button>
      </div>`;
    return card;
  }

  // â”€â”€ ì•¼ë¥´~ í† ê¸€ (í”¼ë“œ ì¹´ë“œ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function toggleYar(e, postId) {
    e.stopPropagation();
    if (!myNickname) {
      pendingYarId = postId; pendingAction = 'yar';
      openNickModal('ì•¼ë¥´~ë¥¼ ëˆ„ë¥´ë ¤ë©´ ë‹‰ë„¤ì„ì´ í•„ìš”í•´ìš”!');
      return;
    }
    const wasYar = getYar(postId);
    const post = feedPosts.find(p => p.id == postId);
    if (!post) return;

    post.yar_count = (post.yar_count||0) + (wasYar ? -1 : 1);
    setYar(postId, !wasYar);
    const btn = document.getElementById(`yar-${postId}`);
    if (btn) {
      btn.className = `yar-btn${!wasYar?' active bounce':''}`;
      btn.innerHTML = `ğŸŒŸ ì•¼ë¥´~ ${post.yar_count}`;
      btn.addEventListener('animationend', () => btn.classList.remove('bounce'), { once:true });
    }
    // ìƒì„¸ íŒ¨ë„ì´ ì—´ë ¤ìˆê³  ê°™ì€ ê²Œì‹œê¸€ì´ë©´ ë™ê¸°í™”
    if (currentPost?.id == postId) syncDetailYar(post.yar_count, !wasYar);

    try {
      const r = await fetch(`${API}/posts/${postId}/yar`, {
        method: wasYar ? 'DELETE' : 'POST',
        credentials: 'include',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify({}),
      });
      const d = await r.json();
      if (d.ok) {
        post.yar_count = d.yar_count;
        if (btn) btn.innerHTML = `ğŸŒŸ ì•¼ë¥´~ ${d.yar_count}`;
        if (currentPost?.id == postId) syncDetailYar(d.yar_count, !wasYar);
      } else {
        // ì„œë²„ ì‹¤íŒ¨ â†’ ë¡¤ë°±
        post.yar_count = (post.yar_count||0) + (wasYar ? 1 : -1);
        setYar(postId, wasYar);
        if (btn) { btn.className = `yar-btn${wasYar?' active':''}`; btn.innerHTML = `ğŸŒŸ ì•¼ë¥´~ ${post.yar_count}`; }
        if (currentPost?.id == postId) syncDetailYar(post.yar_count, wasYar);
        if (d.error === 'nickname_required') { myNickname = null; openNickModal('ì•¼ë¥´~ë¥¼ ëˆ„ë¥´ë ¤ë©´ ë‹‰ë„¤ì„ì´ í•„ìš”í•´ìš”!'); }
      }
    } catch {
      // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ â†’ ë¡¤ë°±
      post.yar_count = (post.yar_count||0) + (wasYar ? 1 : -1);
      setYar(postId, wasYar);
      if (btn) { btn.className = `yar-btn${wasYar?' active':''}`; btn.innerHTML = `ğŸŒŸ ì•¼ë¥´~ ${post.yar_count}`; }
      if (currentPost?.id == postId) syncDetailYar(post.yar_count, wasYar);
    }
  }

  // â”€â”€ ê²Œì‹œê¸€ ìƒì„¸ íŒ¨ë„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function openDetail(postId) {
    // feedPosts ë˜ëŠ” ê³µì§€(allNotices)ì—ì„œ ì°¾ê¸°
    currentPost = feedPosts.find(p => p.id == postId) || allNotices.find(p => p.id == postId) || null;
    // ì´ˆê¸°í™”
    commentSort = 'latest';
    switchCommentTab('latest', false);
    document.getElementById('dTitle').textContent  = '';
    document.getElementById('dBody').innerHTML     = 'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
    document.getElementById('dAuthor').textContent = '';
    document.getElementById('dTime').textContent   = '';
    document.getElementById('dStats').textContent  = '';
    document.getElementById('dComments').innerHTML = '';
    document.getElementById('dMedia').innerHTML    = '';
    document.getElementById('detailOverlay').classList.remove('hidden');
    document.getElementById('commentInput').value  = '';

    // ì¡°íšŒìˆ˜ +1
    fetch(`${API}/posts/${postId}/view`, { method:'POST' }).catch(() => {});

    try {
      const r = await fetch(`${API}/posts/${postId}`);
      const d = await r.json();
      if (!d.ok) { document.getElementById('dBody').textContent = 'ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ì–´ìš”'; return; }
      const p = d.post;
      currentPost     = { ...p, yar_count: d.post.yar_count || currentPost?.yar_count || 0 };
      currentComments = d.comments || [];

      const isSystem   = p.author_type === 'system';
      const authorName = isSystem ? (p.character_name||'ìºë¦­í„°') : (p.nickname||'ìµëª…');

      document.getElementById('dTitle').textContent  = p.title || '';
      document.getElementById('dBody').innerHTML     = linkify(p.body || '');
      document.getElementById('dAuthor').textContent = authorName;
      document.getElementById('dTime').textContent   = relTime(p.created_at);
      document.getElementById('dStats').textContent  =
        `ğŸ’¬ ëŒ“ê¸€ ${d.comments?.length||0} Â· ğŸ‘ ì¡°íšŒ ${p.view_count||0}`;

      // ë¯¸ë””ì–´ (ì´ë¯¸ì§€ / ë™ì˜ìƒ)
      const mediaWrap = document.getElementById('dMedia');
      mediaWrap.innerHTML = '';
      if (p.media_url) {
        const mtype = detectMediaType(p.media_url);
        if (mtype === 'image') {
          mediaWrap.innerHTML = `<img src="${esc(p.media_url)}" alt="ì´ë¯¸ì§€" onclick="this.requestFullscreen?.()" style="cursor:zoom-in;">`;
        } else if (mtype === 'video') {
          mediaWrap.innerHTML = `<video src="${esc(p.media_url)}" controls playsinline></video>`;
        } else if (mtype === 'audio') {
          mediaWrap.innerHTML = `<div class="detail-media-icon">ğŸµ ìŒì•…</div><audio src="${esc(p.media_url)}" controls></audio>`;
        } else if (p.media_url) {
          // YouTube ë“± ì™¸ë¶€ ë§í¬ ì„ë² ë“œ
          const ytMatch = p.media_url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
          if (ytMatch) {
            mediaWrap.innerHTML = `<div style="position:relative;padding-top:56.25%;border-radius:12px;overflow:hidden;"><iframe src="https://www.youtube.com/embed/${ytMatch[1]}" style="position:absolute;inset:0;width:100%;height:100%;border:none;" allowfullscreen></iframe></div>`;
          } else {
            mediaWrap.innerHTML = `<a href="${esc(p.media_url)}" target="_blank" rel="noopener" style="color:var(--blue);font-size:13px;">ğŸ”— ì²¨ë¶€ ë§í¬ ì—´ê¸°</a>`;
          }
        }
      }

      const isYar = getYar(postId);
      syncDetailYar(p.yar_count||0, isYar);
      renderComments(currentComments);
    } catch (e) {
      document.getElementById('dBody').textContent = `ì˜¤ë¥˜: ${e.message}`;
    }
  }

  function syncDetailYar(count, active) {
    const btn = document.getElementById('dYarBtn');
    btn.className = `detail-yar${active?' active':''}`;
    btn.innerHTML = `ğŸŒŸ ì•¼ë¥´~ ${count}`;
  }

  async function toggleDetailYar() {
    if (!currentPost) return;
    if (!myNickname) {
      pendingAction = 'yar';
      pendingYarId  = currentPost.id;
      openNickModal('ì•¼ë¥´~ë¥¼ ëˆ„ë¥´ë ¤ë©´ ë‹‰ë„¤ì„ì´ í•„ìš”í•´ìš”!');
      return;
    }
    // í”¼ë“œ ì¹´ë“œ toggleYar ì¬ì‚¬ìš©
    await toggleYar({ stopPropagation: () => {} }, currentPost.id);
  }

  function closeDetail() {
    document.getElementById('detailOverlay').classList.add('hidden');
    currentPost = null; currentComments = [];
  }
  function handleDetailOverlay(e) { if (e.target.id === 'detailOverlay') closeDetail(); }

  function switchCommentTab(sort, rerender = true) {
    commentSort = sort;
    const btnL = document.getElementById('cTabLatest');
    const btnP = document.getElementById('cTabPopular');
    if (!btnL || !btnP) return;
    btnL.className = 'ctab' + (sort === 'latest'  ? ' ctab-active' : '');
    btnP.className = 'ctab' + (sort === 'popular' ? ' ctab-active' : '');
    if (rerender) renderComments(currentComments);
  }

  function renderComments(comments) {
    const wrap = document.getElementById('dComments');
    if (!comments.length) {
      wrap.innerHTML = '<div style="color:var(--sub);font-size:13px;padding:8px 0 16px;">ì•„ì§ ëŒ“ê¸€ì´ ì—†ì–´ìš”. ì²« ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</div>';
      return;
    }
    // ì •ë ¬: ìµœì‹ ìˆœ = created_at desc, ì¸ê¸°ìˆœ = ìºë¦­í„° ëŒ“ê¸€ ìš°ì„  í›„ ìµœì‹ ìˆœ
    let sorted = [...comments];
    if (commentSort === 'popular') {
      sorted.sort((a, b) => {
        const aS = a.author_type === 'system' ? 1 : 0;
        const bS = b.author_type === 'system' ? 1 : 0;
        if (bS !== aS) return bS - aS;
        return new Date(b.created_at) - new Date(a.created_at);
      });
    } else {
      sorted.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
    }
    wrap.innerHTML = sorted.map(cm => {
      const nick     = cm.system_users?.display_name || cm.nickname || 'ìµëª…';
      const imgUrl   = cm.system_users?.image_url;
      const emoji    = cm.system_users?.emoji || 'ğŸ—£ï¸';
      const avatarHtml = imgUrl
        ? `<img src="${esc(imgUrl)}" alt="${esc(nick)}" data-emoji="${esc(emoji)}" onerror="this.outerHTML='<span style=\'font-size:15px;\'>' + this.dataset.emoji + '</span>'">`
        : `<span style="font-size:15px;">${esc(emoji)}</span>`;
      return `<div class="comment-item">
        <div class="comment-avatar">${avatarHtml}</div>
        <div class="comment-right">
          <div class="comment-nick">${esc(nick)}</div>
          <div class="comment-body">${esc(cm.body)}</div>
          <div class="comment-time">${relTime(cm.created_at)}</div>
        </div>
      </div>`;
    }).join('');
  }

  // â”€â”€ ëŒ“ê¸€ ì‘ì„± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('commentInput').addEventListener('keypress', e => {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); submitComment(); }
  });

  async function submitComment() {
    if (!currentPost) return;
    // ë‹‰ë„¤ì„ì´ ì—†ìœ¼ë©´ ì„œë²„ì—ì„œ ì¬í™•ì¸ í›„ íŒë‹¨
    if (!myNickname && guestId) {
      try {
        const m = await fetch(`${API}/me`, { credentials:'include' });
        if (m.ok) { const md = await m.json(); myNickname = md.guest?.nickname || null; }
      } catch {}
      if (!myNickname) myNickname = localStorage.getItem('rkNickname');
    }
    if (!myNickname) {
      pendingAction = 'comment';
      openNickModal('ëŒ“ê¸€ì„ ì“°ë ¤ë©´ ë‹‰ë„¤ì„ì´ í•„ìš”í•´ìš”!');
      return;
    }
    const body = document.getElementById('commentInput').value.trim();
    if (!body) return;

    const btn = document.getElementById('.comment-send') || document.querySelector('.comment-send');
    if (btn) { btn.disabled = true; btn.textContent = 'ì „ì†¡ì¤‘'; }

    try {
      const r = await fetch(`${API}/posts/${currentPost.id}/comments`, {
        method:'POST', credentials:'include',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ body, guest_id: guestId }),
      });
      const d = await r.json();
      if (d.ok) {
        document.getElementById('commentInput').value = '';
        // ëŒ“ê¸€ ìƒˆë¡œê³ ì¹¨
        const r2 = await fetch(`${API}/posts/${currentPost.id}`);
        const d2 = await r2.json();
        currentComments = d2.comments || [];
        renderComments(currentComments);
        document.getElementById('dStats').textContent =
          `ğŸ’¬ ëŒ“ê¸€ ${d2.comments?.length||0} Â· ğŸ‘ ì¡°íšŒ ${d2.post?.view_count||0}`;
        // í”¼ë“œ ì¹´ë“œ ëŒ“ê¸€ ìˆ˜ ì—…ë°ì´íŠ¸
        const fp = feedPosts.find(p => p.id == currentPost.id);
        if (fp) { fp.comment_count = (fp.comment_count||0)+1; renderFeed(); }
      } else if (d.error === 'nickname_required') {
        // ì„œë²„ê°€ ë‹‰ë„¤ì„ ì—†ë‹¤ê³  ì‘ë‹µ â†’ myNickname ì´ˆê¸°í™” í›„ ëª¨ë‹¬ í‘œì‹œ
        myNickname = null;
        pendingAction = 'comment';
        openNickModal('ëŒ“ê¸€ì„ ì“°ë ¤ë©´ ë‹‰ë„¤ì„ì´ í•„ìš”í•´ìš”!');
      } else {
        alert(d.error || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”');
      }
    } catch (e) { alert(`ì˜¤ë¥˜: ${e.message}`); }

    if (btn) { btn.disabled = false; btn.textContent = 'ì „ì†¡'; }
  }

  // â”€â”€ ìºë¦­í„° í”„ë¡œí•„ íŒ¨ë„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function openProfile(charId) {
    const c = characters.find(x => x.id == charId);
    if (!c) return;
    setVisit(c.id); renderCharGrid();

    const av = document.getElementById('pAvatar');
    if (c.image_url) {
      av.innerHTML = `<img src="${esc(c.image_url)}" alt="${esc(c.display_name)}" data-emoji="${esc(c.emoji||'ğŸ™‚')}" onerror="this.parentElement.removeChild(this);this.parentElement.textContent=this.dataset.emoji">`;
    } else {
      av.textContent = c.emoji || 'ğŸ™‚';
    }
    document.getElementById('pName').textContent = c.display_name;
    document.getElementById('pMeta').textContent = `${groupLabel(c.group_type)} Â· ${c.animal_type||''} Â· ${c.mbti||''}`;
    document.getElementById('pTags').innerHTML = [
      c.likes       && `<div class="profile-tag">â¤ï¸ ${esc(c.likes)}</div>`,
      c.hobby       && `<div class="profile-tag">ğŸ¯ ${esc(c.hobby)}</div>`,
      c.mbti        && `<div class="profile-tag">${esc(c.mbti)}</div>`,
      c.animal_type && `<div class="profile-tag">${esc(c.animal_type)}</div>`,
    ].filter(Boolean).join('');
    document.getElementById('profileOverlay').classList.remove('hidden');

    const pp = document.getElementById('pPosts');
    pp.innerHTML = '<div style="color:var(--sub);font-size:13px;">ë¡œë”© ì¤‘...</div>';
    try {
      const r = await fetch(`${API}/characters/${c.id}/posts?limit=5`);
      const d = await r.json();
      pp.innerHTML = d.posts?.length
        ? d.posts.map(p => `<div class="profile-post" onclick="closeProfile();openDetail(${p.id})">
            <div class="profile-post-title">${esc(p.title||p.body?.slice(0,30)||'')}</div>
            <div class="profile-post-meta">ëŒ“ê¸€ ${p.comment_count||0} Â· ì¡°íšŒ ${p.view_count||0} Â· ${relTime(p.created_at)}</div>
          </div>`).join('')
        : '<div style="color:var(--sub);font-size:13px;">ì•„ì§ ê¸€ì´ ì—†ì–´ìš”</div>';
    } catch { pp.innerHTML = '<div style="color:var(--sub);font-size:13px;">ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</div>'; }
  }
  function closeProfile()                 { document.getElementById('profileOverlay').classList.add('hidden'); }
  function handleProfileOverlay(e)        { if (e.target.id === 'profileOverlay') closeProfile(); }

  // â”€â”€ ê¸€ì“°ê¸° ëª¨ë‹¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openWrite() {
    if (!myNickname) {
      pendingAction = 'write';
      openNickModal('ê¸€ì„ ì“°ë ¤ë©´ ë‹‰ë„¤ì„ì´ í•„ìš”í•´ìš”!');
      return;
    }
    document.getElementById('writeOverlay').classList.remove('hidden');
    document.getElementById('writeTitle').focus();
    document.getElementById('writeError').textContent = '';
  }
  function closeWrite() {
    document.getElementById('writeOverlay').classList.add('hidden');
  }
  function handleWriteOverlay(e) { if (e.target.id === 'writeOverlay') closeWrite(); }

  async function submitWrite() {
    const title = document.getElementById('writeTitle').value.trim();
    const body  = document.getElementById('writeBody').value.trim();
    const errEl = document.getElementById('writeError');
    const btn   = document.getElementById('writeSubmitBtn');

    if (title.length < 2) { errEl.textContent = 'ì œëª©ì€ 2ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”'; return; }
    if (body.length  < 5) { errEl.textContent = 'ë‚´ìš©ì€ 5ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”'; return; }
    errEl.textContent = '';

    btn.disabled = true; btn.textContent = 'ê²Œì‹œ ì¤‘...';
    try {
      const r = await fetch(`${API}/posts`, {
        method: 'POST', credentials: 'include',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify({ title, body, guest_id: guestId }),
      });
      const d = await r.json();
      if (d.ok) {
        document.getElementById('writeTitle').value = '';
        document.getElementById('writeBody').value  = '';
        closeWrite();
        // í”¼ë“œ ìƒˆë¡œê³ ì¹¨
        await loadFeed(true);
      } else if (d.error === 'nickname_required') {
        myNickname = null; closeWrite();
        openNickModal('ê¸€ì„ ì“°ë ¤ë©´ ë‹‰ë„¤ì„ì´ í•„ìš”í•´ìš”!');
      } else if (d.error === 'rate_limit_post') {
        errEl.textContent = 'ë„ˆë¬´ ë¹ ë¦…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”';
      } else {
        errEl.textContent = d.error || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”';
      }
    } catch { errEl.textContent = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”'; }
    btn.disabled = false; btn.textContent = 'ê²Œì‹œí•˜ê¸°';
  }

  // â”€â”€ ë‹‰ë„¤ì„ ëª¨ë‹¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openNickModal(sub) {
    document.getElementById('nickSub').textContent = sub || 'ë‹‰ë„¤ì„ì´ í•„ìš”í•´ìš”!';
    document.getElementById('nickOverlay').classList.remove('hidden');
    document.getElementById('nickInput').focus();
  }
  function handleNickOverlay(e) { if (e.target.id === 'nickOverlay') document.getElementById('nickOverlay').classList.add('hidden'); }
  document.getElementById('nickInput').addEventListener('keypress', e => { if (e.key==='Enter') submitNickname(); });

  async function submitNickname() {
    const val   = document.getElementById('nickInput').value.trim();
    const errEl = document.getElementById('nickError');
    if (!val || val.length > 10) { errEl.textContent='1~10ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”'; return; }
    if (!/^[ê°€-í£ã„±-ã…ã…-ã…£a-zA-Z0-9]+$/.test(val)) { errEl.textContent='í•œê¸€, ì˜ë¬¸, ìˆ«ìë§Œ ê°€ëŠ¥í•´ìš”'; return; }
    errEl.textContent = '';
    try {
      const r = await fetch(`${API}/guest/nickname`, {
        method:'POST', credentials:'include',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ nickname:val, guest_id:guestId }),
      });
      const d = await r.json();
      if (d.ok) {
        myNickname = d.nickname;
        localStorage.setItem('rkNickname', d.nickname);
        document.getElementById('nickOverlay').classList.add('hidden');
        document.getElementById('nickInput').value = '';
        // ëŒ€ê¸° ì¤‘ì¸ ì‘ì—… ì‹¤í–‰
        if (pendingAction === 'yar' && pendingYarId) {
          const id = pendingYarId; pendingYarId = null; pendingAction = null;
          toggleYar({ stopPropagation:()=>{} }, id);
        } else if (pendingAction === 'comment') {
          pendingAction = null;
          document.getElementById('commentInput').focus();
        } else if (pendingAction === 'write') {
          pendingAction = null;
          openWrite();
        }
      } else {
        errEl.textContent = d.error || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”';
      }
    } catch { errEl.textContent = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”'; }
  }

  // â”€â”€ MOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const MOCK_CHARS = [
    {id:1, display_name:'ì„ì¼í›„',   emoji:'ğŸ¦†', group_type:'kindergarten', animal_type:'ì˜¤ë¦¬',     gender:'ê³ ì',   mbti:'ENTP', likes:'ì•„ì´ëŒ',   hobby:'ëˆ•ê¸°'},
    {id:2, display_name:'ì¨©êµ¬ë¦¬',   emoji:'ğŸ¸', group_type:'kindergarten', animal_type:'ê°œêµ¬ë¦¬',   gender:'female', mbti:'ESTP', likes:'ê²Œì„',     hobby:'ê°œêµ´ê±°ë¦¬ê¸°'},
    {id:3, display_name:'ì¨©ê·œë¦¬',   emoji:'ğŸ¸', group_type:'kindergarten', animal_type:'ê°œêµ¬ë¦¬',   gender:'female', mbti:'ENFP', likes:'ë†€ê¸°',     hobby:'ì¥ë‚œì¹˜ê¸°'},
    {id:4, display_name:'ë£¨í”¼',     emoji:'ğŸ¦«', group_type:'kindergarten', animal_type:'ë¹„ë²„',     gender:'male',   mbti:'INTP', likes:'ê±¸ê·¸ë£¹',   hobby:'í‚¥ë³µì‹±'},
    {id:5, display_name:'ì•¼ì½”',     emoji:'ğŸ·', group_type:'kindergarten', animal_type:'ë¼ì§€',     gender:'male',   mbti:'ENFP', likes:'ë¯¼ì´ˆ',     hobby:'ë¯¼ì´ˆë¨¹ê¸°'},
    {id:6, display_name:'ìš°ì‚¬ê¸°',   emoji:'ğŸ°', group_type:'kindergarten', animal_type:'í† ë¼',     gender:'female', mbti:'ISTP', likes:'ê³µë¶€',     hobby:'ê³µë¶€'},
    {id:7, display_name:'ì¨©ë‹´ê³°',   emoji:'ğŸ»', group_type:'kindergarten', animal_type:'ê³°',       gender:'female', mbti:'ISTJ', likes:'ì²œì¬',     hobby:'ì ìê¸°'},
    {id:8, display_name:'ì¨©ë¹¤ì®¸',   emoji:'ğŸ°', group_type:'kindergarten', animal_type:'í† ë¼',     gender:'female', mbti:'ENFP', likes:'íŒ¬í‹°',     hobby:'ë³µì‹±'},
    {id:9, display_name:'ì¨©ì„¤',     emoji:'ğŸ¯', group_type:'kindergarten', animal_type:'í˜¸ë‘ì´',   gender:'female', mbti:'ENFP', likes:'ìŠ¤í‚¤',     hobby:'íƒœê¶Œë„'},
    {id:10,display_name:'ì¹˜ì´ì¹´ì™€', emoji:'ğŸ»', group_type:'kindergarten', animal_type:'ê³°',       gender:'female', mbti:'ENFP', likes:'ìš”ì¿ ë¥´íŠ¸', hobby:'ìš”êµ¬ë¥´íŠ¸ë¨¹ê¸°'},
    {id:11,display_name:'í•˜ì¹˜ì™€ë ˆ', emoji:'ğŸ±', group_type:'kindergarten', animal_type:'ê³ ì–‘ì´',   gender:'female', mbti:'ENFP', likes:'ê·€ì—¬ìš´ê±°', hobby:'ë…¸ë˜'},
    {id:12,display_name:'ì¨©ë¬¸ì–´',   emoji:'ğŸ™', group_type:'kindergarten', animal_type:'ë°˜ì „ë¬¸ì–´', gender:'female', mbti:'ENFP', likes:'ì°©í•œê±°',   hobby:'ë…¸ë˜ë¶€ë¥´ê¸°'},
    {id:13,display_name:'ì¨©ìŠ',     emoji:'ğŸ¦§', group_type:'kindergarten', animal_type:'ì˜¤ë‘ìš°íƒ„', gender:'female', mbti:'ENFP', likes:'ë¦¬ë“¬ì²´ì¡°', hobby:'ë¨¹ê¸°'},
    {id:14,display_name:'ì¨©ì†¡',     emoji:'ğŸ¦§', group_type:'kindergarten', animal_type:'ì˜¤ë‘ìš°íƒ„', gender:'female', mbti:'ENFP', likes:'ë®¤ì§€ì»¬',   hobby:'íŠ¸ë¡¯íŠ¸ë¶€ë¥´ê¸°'},
    {id:15,display_name:'ë£¹í¬',     emoji:'ğŸ¦«', group_type:'daycare',      animal_type:'ë¹„ë²„',     gender:'female', mbti:'ENFP', likes:'ì¹˜í‚¨',     hobby:'ê¶Œíˆ¬'},
    {id:16,display_name:'ë¤‚ì´',     emoji:'ğŸ¦«', group_type:'daycare',      animal_type:'ë¹„ë²„',     gender:'female', mbti:'ESTJ', likes:'ìŒì ˆê³¤',   hobby:'ìŒì ˆê³¤'},
    {id:17,display_name:'ì‚¬ë™',     emoji:'ğŸ·', group_type:'daycare',      animal_type:'ë¼ì§€',     gender:'male',   mbti:'ENFP', likes:'ë°±ì„¤ì´',   hobby:'ìœ íŠœë¸Œë³´ê¸°'},
    {id:18,display_name:'ì¨©ë§Œë“€',   emoji:'ğŸ™', group_type:'daycare',      animal_type:'ë°˜ì „ë¬¸ì–´', gender:'female', mbti:'ISTP', likes:'ê¹¨ë—í•œê±°', hobby:'ê·¸ë¦¼ê·¸ë¦¬ê¸°'},
    {id:19,display_name:'ì¨©ë§Œì¥¬',   emoji:'ğŸ™', group_type:'daycare',      animal_type:'ë°˜ì „ë¬¸ì–´', gender:'female', mbti:'ISTP', likes:'ë§›ìˆëŠ”ê±°', hobby:'ë¨¹ê¸°'},
    {id:20,display_name:'ì¨©ë¬´ë„ˆ',   emoji:'ğŸ™', group_type:'daycare',      animal_type:'ë°˜ì „ë¬¸ì–´', gender:'female', mbti:'ISTP', likes:'ë†€ê¸°',     hobby:'ë†€ê¸°'},
    {id:21,display_name:'ì¨©ì„œë¹ˆ',   emoji:'ğŸ¦›', group_type:'daycare',      animal_type:'ë² ë êµ¬ì–´', gender:'female', mbti:'ENFP', likes:'ìª½ìª½ì´',   hobby:'ìª½ìª½ì´ë¬¼ê¸°'},
    {id:22,display_name:'ì¨©í¬ìš©',   emoji:'ğŸ¶', group_type:'daycare',      animal_type:'ê°•ì•„ì§€',   gender:'female', mbti:'ENFP', likes:'íŒ¨ê¸°',     hobby:'íŒ¨ê¸°'},
    {id:23,display_name:'ì¨©ì„¸ë¹ˆ',   emoji:'ğŸ¦›', group_type:'daycare',      animal_type:'ë² ë êµ¬ì–´', gender:'female', mbti:'ENFP', likes:'ìˆë†ˆ',     hobby:'ì€ê·¼ì”'},
    {id:24,display_name:'ì‘¤ê°ˆìŒˆ',   emoji:'ğŸ‘©â€ğŸ«',group_type:'teacher',      animal_type:'ì„ ìƒë‹˜',   gender:'female', mbti:'ENFJ-T',likes:'ì•„ì´ë“¤',  hobby:'ê´€ì°°ë©”ëª¨'},
  ];

  // â”€â”€ ì´ˆê¸° ë¡œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function init() {
    await initGuest();
    await Promise.all([loadNotices(), loadCharacters(), loadFeed(true)]);
    document.getElementById('globalLoader').classList.add('hidden');
  }
  init();
</script>
</body>
</html>
